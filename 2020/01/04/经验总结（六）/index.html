<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>经验总结（六） | Hopkin</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">经验总结（六）</h1><a id="logo" href="/.">Hopkin</a><p class="description">一个普通程序员的碎碎念 (。・∀・)ノ</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">经验总结（六）</h1><div class="post-meta">Jan 4, 2020<span> | </span><span class="category"><a href="/categories/计算机基础/">计算机基础</a><a href="/categories/计算机基础/Android知识/">Android知识</a></span></div><div class="post-content"><p>MainDex中的类</p>
<p><a href="https://juejin.im/post/5c5bee986fb9a049bc4d1b58" target="_blank" rel="noopener">https://juejin.im/post/5c5bee986fb9a049bc4d1b58</a></p>
<p>综上两点所述和前面对 MultiDexTransform#computeList() 方法所述，最终打入 maindex 中的 class 会有以下几个部分组成：</p>
<ul>
<li>默认的 keep 规则中的类（如 application、annotation）；</li>
<li>开发者通过 multiDexKeepProguard 配置的类；</li>
<li>前两者所涉及到的类的引用类；</li>
<li>所有类本身、类方法、类字段其中任一被<strong>运行时注解</strong>所修饰的类；（可选项）</li>
<li>开发者通过 multiDexKeepFile 配置的类</li>
</ul>
<p><strong>dalvik VS art 在multidex方面的区别</strong></p>
<p>dalvik和art重要的区别就是dalvik执行的是dex字节码，而art虚拟机执行的是本地机器码。dalvik采用的是JIT(Just-in-Time)解释器在程序运行时动态的将dex字节码翻译成本地机器码，并且在程序每次重新运行的时候都需要重复这一步骤，所以dalvik的执行效率要低于art。</p>
<p>android 4.4以后开始引入art，art虚拟机执行的是本地机器码，而之前dalvik虚拟机上运行的app中包含的都是dex文件，所以就需要一个将dex文件翻译成本地机器码的过程。ART采用的是AOT(Ahead-of-Time),即在程序运行之前就将dex文件翻译成本地机器码，时机就在app安装的时候。</p>
<p>app在安装的过程中，PackageManagerService会请求守护进程installd来执行一次dexopt操作，即对dex字节码进行优化或者翻译，如果系统使用的是dalvik虚拟机，则会调用run_dexopt来将dex文件优化成odex文件,此处只会对classes.dex文件即主dex文件进行优化操作（这个应该是首次冷启动才会dex2opt？）  ；如果系统使用的是art虚拟机，则会调用run_dex2oat来将dex文件翻译成本地机器码并保存在oat文件中，如果apk中含有多个dex文件，则会对多个dex文件都会进行解释处理，并保存到oat文件中。</p>
<p>所以在程序运行时，如果是dalvik虚拟机，则只会加载主dex的odex文件，而从dex文件需要通过multidex的方式手动进行dexopt和加载操作，如果是art虚拟机，则直接加载oat文件即可。</p>
<p><a href="http://www.jianshu.com/p/e96f345e822f" target="_blank" rel="noopener">http://www.jianshu.com/p/e96f345e822f</a></p>
<p>DexClassLoader PathClassLoader区别：</p>
<ul>
<li>DexClassLoader构造函数多了一个可以指定优化dex的路径，基本没其他区别</li>
<li>MutliDex.install 是直接获取当前classLoader，然后利用反射取得dexPathList，再取得dexPathList的Elements，然后通过反射调用makeElements，最后合并</li>
<li>插桩一般是直接利用new DexClassLoader加载，因为new 的过程的过程会触发dexPathList的elements生成，可以直接通过反射拿到其elements来合并，比较方便，其实也可以用PathClassLoader，只不过无法指定优化dex的目录，只能在当前dexPath目前下，一般是外存，不太合适；也可以和MutliDex一样，直接通过当前classLoader反射手动调用makeElements，再合并，比较麻烦</li>
</ul>
<p>类的声明周期——卸载</p>
<ul>
<li>该类所有的实例都已经被回收，也就是java堆中不存在该类的任何实例。</li>
<li>加载该类的ClassLoader已经被回收（这个似乎很难？）</li>
<li>该类对应的java.lang.Class对象没有任何地方被引用，无法在任何地方通过反射访问该类的方法。</li>
</ul>
<p>屏幕绘制问题</p>
<p><a href="https://www.jianshu.com/p/02800806356" target="_blank" rel="noopener">https://www.jianshu.com/p/02800806356</a></p>
<p><a href="https://www.jianshu.com/p/71703df6df40" target="_blank" rel="noopener"><strong>https://www.jianshu.com/p/71703df6df40</strong></a> <strong>(好文)</strong></p>
<p>（双缓冲，三缓冲）</p>
<p>在16ms内绘制不完会丢帧，但是总体比以前流畅，但最好还是都需要在帧时间内绘制完</p>
<p>Dialog全屏</p>
<p><a href="https://juejin.im/post/58de0a9a44d904006d04cead" target="_blank" rel="noopener">https://juejin.im/post/58de0a9a44d904006d04cead</a></p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:windowIsFloating"</span>&gt;<span class="literal">false</span>&lt;/<span class="built_in">item</span>&gt; </span><br><span class="line"></span><br><span class="line">&lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:windowBackground"</span>&gt;@color/transparent&lt;/<span class="built_in">item</span>&gt; </span><br><span class="line"></span><br><span class="line">&lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:windowNoTitle"</span>&gt;<span class="literal">true</span>&lt;/<span class="built_in">item</span>&gt;</span><br></pre></td></tr></table></figure>
<p>一般情况下：</p>
<ul>
<li>taskAffinity相同，NEW_TASK单独使用无效，不同等于SingleTask</li>
<li>在taskAffinity相同的情况下，FLAG_ACTIVITY_NEW_TASK + FLAG_ACTIVITY_CLEAR_TOP标志位组合确实不会创建新的任务栈，但是会清除了FirstActivity及其之上的所有Activity，并新建FirstActivity实例添加到了当前任务栈，这点是和SingleTask模式的差异。不同的情况下也不会复用。</li>
<li>CLEAR_TOP单独使用，只有非Standard启动模式的目标Activity才会被复用，其他启动模式的目标Activity都先被删除，然后被重新创建并入栈；若是使用FLAG_ACTIVITY_SINGLE_TOP和FLAG_ACTIVITY_CLEAR_TOP标志位组合，那么不管目标Activity是什么启动模式，都会被复用</li>
<li>CLEAR_TASK会先清除task</li>
</ul>
<p>gradle extension</p>
<p><a href="https://www.heqiangfly.com/2016/04/16/development-tool-gradle-customized-plugin-dsl-extension/" target="_blank" rel="noopener">https://www.heqiangfly.com/2016/04/16/development-tool-gradle-customized-plugin-dsl-extension/</a></p>
<ul>
<li>创造普通DSL的extension</li>
<li>创建嵌套DSL的extension（this.extensions.create ObjectFactory）</li>
<li>创建嵌套DSL并且具有多个名字的容器extension (NameDomainObjectContainer)</li>
</ul>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>hopkin</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2020/01/04/经验总结（六）/">https://hb-pencil.github.io/2020/01/04/经验总结（六）/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>Copyright © 2019 Hopkin</li></ul></div><br><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://hb-pencil.github.io/2020/01/04/经验总结（六）/" data-id="ckbnd9pkc002qjwiby25l29g4" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACIklEQVR42u3aMXICMQwFUO5/adKmyJovCZis/VwxmcX4baHIkh6PeD1/rcnf188k3xotDAyM2zKey3X1TPLDyc75/usdMDAwTmBcHeLqmZy93jPZZ302DAwMjPXPV8Px5DMGBgZGNeDmiWD1SQwMDIzJJbZ3oS0cpZU+YmBgnMDIq+7f//yR/gYGBsatGM/iSgJltSWZF/IuT4WBgbE1o3dBrRbj1sfNU8YXwxwYGBgHM6rNy4SdXFmrMAwMjF0ZSWFrXWKrvohJA+ASjIGBsTVjEsGq7YFeoX9UQcTAwNiU0WtbJgFxFDon2S4GBsYWjN5FNAm1k8ZAckIMDIwzGfklM8G/tyT3AoyBgbEpo9donIOr7cwXoRwDA2NrxqQxmT9T/W4v+GJgYOzNSAr91QZkUvSfDFtgYGCcw8iHKqpjGTmpus9lhouBgbEpo3cp7Q2K9RLNQjMDAwNjU8YkdM6Lcb2r7B+nxcDA2Joxqc9NEsc8TBeanRgYGAcwqhfX0QjXuNw2mhnBwMC4LSPZOjncN0crMDAwTmNUi/LztDIPyuVpEQwMjI0Yz+KqFsXm4TXZBwMDY29GL9jNm529F5QkixgYGLsykh/ovYlJupm3JTAwMM5hTJqU0TBEEVkN/RgYGBiTS2w1Wey1MzEwMDCSwa/eyFfvlX3k/wYGBsa/Z8zD3wSQl9jeUG7DwMC4ISO/Os5bCNUw3Rv1wMDA2IjxA+BH+ggQTM5zAAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="/tags/小技巧/">小技巧</a><a href="/tags/零碎知识/">零碎知识</a><a href="/tags/经验总结/">经验总结</a></div><div class="post-nav"><a class="pre" href="/2020/01/04/经验总结（五）/">经验总结（五）</a><a class="next" href="/2019/11/23/Activity的启动过程浅析/">Activity的启动过程浅析</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/">计算机基础</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/Android基础/">Android基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/Android知识/">Android知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/数据结构与算法/">数据结构与算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/计算机网络/">计算机网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/计算机语言/">计算机语言</a></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/随笔杂文/" style="font-size: 15px;">随笔杂文</a> <a href="/tags/经验记录/" style="font-size: 15px;">经验记录</a> <a href="/tags/小技巧/" style="font-size: 15px;">小技巧</a> <a href="/tags/计算机知识/" style="font-size: 15px;">计算机知识</a> <a href="/tags/零碎知识/" style="font-size: 15px;">零碎知识</a> <a href="/tags/他山之石/" style="font-size: 15px;">他山之石</a> <a href="/tags/新技术/" style="font-size: 15px;">新技术</a> <a href="/tags/胡思乱想/" style="font-size: 15px;">胡思乱想</a> <a href="/tags/经验总结/" style="font-size: 15px;">经验总结</a> <a href="/tags/kotlin/" style="font-size: 15px;">kotlin</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/03/22/SharePreferences原理浅析/">SharePreferences原理浅析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/12/Binder IPC/">Binder & TCP</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/04/经验总结（五）/">经验总结（五）</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/04/经验总结（六）/">经验总结（六）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/23/Activity的启动过程浅析/">Activity的启动过程浅析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/22/kotlin的若干特性/">Kotln的若干特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/20/经验总结（四）/">经验总结（四）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/08/经验总结（三）/">经验总结（三）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/25/事件总线思想简述/">事件总线思想简述</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/24/经验总结（二）/">经验总结（二）</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Hopkin.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>