<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>经验总结（三） | Hopkin</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">经验总结（三）</h1><a id="logo" href="/.">Hopkin</a><p class="description">一个普通程序员的碎碎念 (。・∀・)ノ</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">经验总结（三）</h1><div class="post-meta">Sep 8, 2019<span> | </span><span class="category"><a href="/categories/计算机基础/">计算机基础</a><a href="/categories/计算机基础/Android知识/">Android知识</a></span></div><div class="post-content"><h3 id="代码混淆与压缩"><a href="#代码混淆与压缩" class="headerlink" title="代码混淆与压缩"></a>代码混淆与压缩</h3><ul>
<li><p>shrinkResources true</p>
</li>
<li><p>minifyEnabled true</p>
</li>
<li><p>proguardFiles getDefaultProguardFile(‘proguard-android.txt’),</p>
</li>
</ul>
<p>​                    ‘proguard-rules.pro’</p>
<p><em>移除无用代码，资源以及混淆</em></p>
<h3 id="声明主要-DEX-文件中必需的类"><a href="#声明主要-DEX-文件中必需的类" class="headerlink" title="声明主要 DEX 文件中必需的类"></a>声明主要 <strong>DEX</strong> 文件中必需的类</h3><p>为多 dex 文件应用编译每个 DEX 文件时，编译工具会执行复杂的决策制定来确定主要 DEX 文件中需要的类，以便您的应用能够成功启动。如果主要 DEX 文件中未提供启动期间需要的任何类，则您的应用会崩溃并出现 java.lang.NoClassDefFoundError 错误。</p>
<p>对于直接从您的应用代码访问的代码，不应发生这种情况，因为编译工具可以识别这些代码路径。但是，当代码路径的可见性较低时（例如，当您使用的库具有复杂的依赖项时），可能会发生这种情况。例如，如果代码使用自检机制或从原生代码调用 Java 方法，那么可能不会将这些类识别为主要 DEX 文件中的必需类。</p>
<p>因此，如果您收到 java.lang.NoClassDefFoundError，则必须使用版本类型中的 <a href="http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.BuildType.html#com.android.build.gradle.internal.dsl.BuildType:multiDexKeepFile" target="_blank" rel="noopener">multiDexKeepFile</a> 或 <a href="http://google.github.io/android-gradle-dsl/2.2/com.android.build.gradle.internal.dsl.BuildType.html#com.android.build.gradle.internal.dsl.BuildType:multiDexKeepProguard" target="_blank" rel="noopener">multiDexKeepProguard</a> 属性声明这些其他类，以手动将这些类指定为主要 DEX 文件中的必需类。如果某个类在 multiDexKeepFile 或 multiDexKeepProguard 文件中匹配到，则会将该类添加到主要 DEX 文件。</p>
<p>简言之，如果项目依赖复杂，编译过程中主dex可能不能把启动过程所需要的全部类打入，需要手动配置，实际在项目中发现引入太多而导致超出64K限制的问题。请注意！<a href="https://developer.android.com/studio/build/multidex?hl=zh-cn#kotlin" target="_blank" rel="noopener">官方参考文档</a></p>
<h3 id="多语言匹配规则"><a href="#多语言匹配规则" class="headerlink" title="多语言匹配规则"></a>多语言匹配规则</h3><p><a href="https://developer.android.google.cn/guide/topics/resources/multilingual-support" target="_blank" rel="noopener">7.0以下先匹配语言-国家代码，再匹配语言，7.0以上先匹配语言-国家代码语言，再匹配语言-其他国家</a></p>
<h3 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h3><p><a href="http://www.paincker.com/gradle-develop-basics#Groovy" target="_blank" rel="noopener">Gradle开发快速入门</a></p>
<ul>
<li>gradle生命周期包括初始化(Initialization)、配置(Configuration)、执行(Execution)</li>
<li>初始化阶段执行setting.gradle脚本，对应setting对象,建立工程之间的关系</li>
<li>配置阶段依次执行各个build.gradle脚本，对应各自的project对象，并确认要执行的task之间的依赖关系</li>
<li>执行阶段，执行对应task的各个action,遵循之间的依赖条件</li>
<li>ExecutionContainer用于自定义扩展，可以创建task的扩展，在自定义plugin的时候暴露接口给使用者</li>
<li>TaskContainer可以用于创建task对象，可用于自定义plugin</li>
<li>为了提高响应能力，Gradle 默认缓存了所有编译后的脚本. 包括所有的构建脚本，初始化脚本，还有其他脚本. Gradle 创建了一个 .gradle 目录来存放编译后的脚本，下次您运行构建脚本时，如果这个脚本自从它被编译后就再也没有被改动过，Gradle 会先使用编译后的脚本. 否则 Gradle 会重新编译脚本</li>
</ul>
<h3 id="灰度发布和ABTest"><a href="#灰度发布和ABTest" class="headerlink" title="灰度发布和ABTest"></a>灰度发布和ABTest</h3><p><strong>灰度发布和AB Test，本质上来讲，其实都是一样的，灰度发布侧重于全量发布，AB Test侧重于实验，侧重于数据分析，再根据得到的实验结果进行灰度，主要针对于不确定的新功能。</strong></p>
<p>具体来说，一般是先灰度发版，可能有多个功能，有的功能收益确定，直接放量；有的功能针对特定用户收益，目标内放量，需要加控制；有的则是不确定功能，需要进一步评估，小流量进行ABTest，针对实验用户通过线上开关控制，一段时间内观察实验数据，得出结论，再逐步放量。所以AB Test应该是包含了灰度，是灰度的一种。</p>
<p><strong>我的理解：</strong></p>
<ul>
<li><p>功能迭代，确定的收益，针对全部用户放量</p>
</li>
<li><p>功能迭代，确定的收益，针对部分人群放量</p>
</li>
<li><p>风险大，啥也不确定，针对实验用户用AB test放量，观察，再制定策略</p>
</li>
</ul>
<h3 id="class字节码"><a href="#class字节码" class="headerlink" title="class字节码"></a>class字节码</h3><p>符号引用、字面常量</p>
<ul>
<li>常量池中包括 类和接口、字段调用(FieldRef)、方法调用(MethodRef)、部分符号引用NameAndType等符号引用以及字面常量（基本数据类型的值包括utf-8的字节码指令） -&gt; 静态（类加载过程的解析阶段）、动态解析(实际运行过程才解析，比如父类调用抽象方法)</li>
<li>Type包括基本数据类型、引用类型和()V等方法类型</li>
<li>修饰符如public、static、final等在access_flag表里</li>
</ul>
<p><a href="https://www.zhihu.com/question/30300585" target="_blank" rel="noopener">部分参考</a></p>
<p>final 对象在堆</p>
<p><a href="https://blog.csdn.net/u010386612/article/details/80105951#3-解析" target="_blank" rel="noopener">https://blog.csdn.net/u010386612/article/details/80105951#3-%E8%A7%A3%E6%9E%90</a></p>
<p><em>只要能被invokestatic和invokespecail指令调用的方法，都可以在解析（Resolution）阶段中确定方法的调用版本，符合这个条件的有静态方法、私有方法、构造方法、父类方法。它们在类加载时就会把符号引用解析（resolve）为该方法的直接引用，这些方法可以称为非虚方法，与之相反称为虚方法（除final方法）。而虚方法则会在程序运行期间才解析成直接引用。比如字面常量，大部分方法都是静态解析，成员变量，final对象，虚方法，都是只能运行阶段根据实际情况解析，有可能每次解析的内存地址都不一样。</em></p>
<p>字节码结构</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ClassFile &#123; </span><br><span class="line"></span><br><span class="line">​    u4 magic<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    u2 minor_version<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    u2 major_version<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    u2 constant_pool_count<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    cp_info constant_pool[constant_pool_count-<span class="number">1</span>]<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    u2 access_flags<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    u2 this_class<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    u2 super_class<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    u2 interfaces_count<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    u2 interfaces[interfaces_count]<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    u2 fields_count<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    field_info fields[fields_count]<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    u2 methods_count<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    method_info methods[methods_count]<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    u2 attributes_count<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">​    attribute_info attributes[attributes_count]<span class="comment">; </span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Code字节码指令以UTF-8存在于常量池的常量</p>
<p><a href="https://windysha.github.io/2018/01/18/深入理解JVM之Java字节码（-class）文件详解/" target="_blank" rel="noopener">深入理解JVM之Java字节码/</a></p>
<h3 id="热修复-增量更新、全量更新"><a href="#热修复-增量更新、全量更新" class="headerlink" title="热修复/增量更新、全量更新"></a>热修复/增量更新、全量更新</h3><ul>
<li>传统而言，如果App发生影响用户使用的bug，紧急修复后推送用户全量更新，App商店也要进行发版，因为如果用户下载了旧版本后发现还需要再下载一个一样大的安装包，体验非常差，所以必须尽快发版。这样成本太高了</li>
<li>如果采用热修复技术，只需要发布一个小补丁，最理想是让用户无感修复，不用重启</li>
<li>而发版一般是功能的迭代，一个中大型项目，每次发版都是改动比较多的，目前热修复技术大多是不支持大改动的，哪怕是偶尔支持的改动，改动也会比较多，依然需要发版，原因同上，而且，修复是强制性的，而更新是选择性的，没必要用收益很小的热修复去做更新</li>
<li>所以，一般来说，热修复仅仅针对bug修复，强制性，而发版针对功能性迭代，选择性，推送更新一般全量更新，制定一些策略等（如wifi自动下载，静默安装）</li>
</ul>
<h3 id="other"><a href="#other" class="headerlink" title="other"></a>other</h3><ul>
<li><p><shape>的line必须对应<stroke></stroke></shape></p>
</li>
<li><p>Kotlin java互相调用大坑之一：调用java null非受检，目前出现的情况包括：</p>
</li>
</ul>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">代码停止突然运行，像死循环一样</span><br><span class="line">比如 obj.optJsonArray() 返回null，调用这个null.method()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">导致crash，但是没有栈追踪，报错是：</span><br><span class="line"></span><br><span class="line">Attempt <span class="keyword">to</span> invoke <span class="keyword">virtual</span> <span class="function"><span class="keyword">method</span> '<span class="title">android</span>.<span class="title">content</span>.<span class="title">res</span>.<span class="title">Resources</span> <span class="title">android</span>.<span class="title">app</span>.<span class="title">Activity</span>.<span class="title">getResources</span><span class="params">()</span>' <span class="title">on</span> <span class="title">a</span> <span class="title">null</span> <span class="title">object</span> <span class="title">reference</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">难以定位真正的错误</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">比如 <span class="title">var</span> <span class="title">a</span> = ""</span></span><br><span class="line"><span class="function"><span class="title">a</span> = <span class="title">javaObj</span>.<span class="title">getXXXX</span><span class="params">()</span> 返回<span class="title">null</span></span></span><br></pre></td></tr></table></figure></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>hopkin</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2019/09/08/经验总结（三）/">https://hb-pencil.github.io/2019/09/08/经验总结（三）/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>Copyright © 2019 Hopkin</li></ul></div><br><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://hb-pencil.github.io/2019/09/08/经验总结（三）/" data-id="ck0as55pa0001qkibflrz764m" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACK0lEQVR42u3ayw7CMAxE0f7/TxeJHSqYGTtB1L5ZIejrFGmUxD4OeZzP8enzdVyPvB4fX+3YMWDAgHFbxhkO5Rh9xK/GvS8MGDCmMZSQjQNRD2X3vvExMGDAgOFO8uKrxcfnqDBgwIChh6Bys9yyFgYMGDD0RWx8ljtN1Lf2Fq/FYcCAcUNGvTCw7/NP6xswYMD4S0ZuW1/5XprMFZ7k5V4wYMBozahs3LvTtQUTu/hlwYABozUj/rnSBrH2ePs/gQEDRgtG7jQ3ZCsFS2liCgMGjNaM3PKyMnHUywnx1aR6KQwYMNox9PjTv9EDtxL9MGDAmMDItXblWjH0ANWLEzBgwOjNWKBMNX5VGizenAUDBozWDOVR6ltsuSYz/dlgwIAxgWHUORctaPVGCuOaMGDAaMpwA66ycaYvTfVtNRgwYMxkuDfIbdVVFqtfekZgwIDRlCGFmjBxdAsALunjy4UBA8YYhhu4u0sCxlYdDBgwWjPcsHNv7LZwnfKAAQPGHIbebOFume0rfMKAAWMyQ1msusWA3IRSX1TDgAFjAkMJNX2DzG2VcIcR4jBgwGjEOM2hB7FLzUU2DBgwJjDcsFNiVJ9KuoWH3BYeDBgwejByIasHn3tuLuhhwIAxgZELWXcCpxQe9Ohf0J0BAwaMdozK8lV/HXp8JwMXBgwYwxh6O5e+PHafBwYMGHMYlWJAvfxZLxvAgAGjN6NeGHALBm5YLyhewoAB466MB8ezFBnKb90vAAAAAElFTkSuQmCC">分享</a><div class="tags"><a href="/tags/小技巧/">小技巧</a><a href="/tags/经验总结/">经验总结</a></div><div class="post-nav"><a class="next" href="/2019/08/25/事件总线思想简述/">事件总线思想简述</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/">计算机基础</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/Android知识/">Android知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/数据结构与算法/">数据结构与算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/计算机网络/">计算机网络</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机基础/计算机语言/">计算机语言</a></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/随笔杂文/" style="font-size: 15px;">随笔杂文</a> <a href="/tags/计算机知识/" style="font-size: 15px;">计算机知识</a> <a href="/tags/小技巧/" style="font-size: 15px;">小技巧</a> <a href="/tags/经验记录/" style="font-size: 15px;">经验记录</a> <a href="/tags/他山之石/" style="font-size: 15px;">他山之石</a> <a href="/tags/新技术/" style="font-size: 15px;">新技术</a> <a href="/tags/胡思乱想/" style="font-size: 15px;">胡思乱想</a> <a href="/tags/经验总结/" style="font-size: 15px;">经验总结</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/09/08/经验总结（三）/">经验总结（三）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/25/事件总线思想简述/">事件总线思想简述</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/24/经验总结（二）/">经验总结（二）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/11/经验总结（一）/">经验总结（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/12/工作业余计划/">工作业余计划</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/08/Android自定义FlowLayout/">Android自定义FlowLayout</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/22/打家劫舍123/">打家劫舍123</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/16/N数之和/">N数之和</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/10/一些思考和总结/">一些思考和总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/10/2018年终总结/">2018年终总结</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Hopkin.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>